################################################
Dragonkeeper - Opera Dragonfly development proxy
################################################

Introduction
------------

Dragonkeeper is an utility for working on the Opera Dragonfly client.

Dragonfly serves as a proxy between the Dragonfly client and another Opera instance. This makes
it possible to run the Opera Dragonfly client as a normal web page while using another Opera dragonly instance to debug itself. This makes development easy, as on can simple reload the client whenever making
changes to it.

Install
------

python setup.py build
python setup.py install


Usage
-----

python dragonkeeper/dragonkeeper/dragonkeeper.py

Exit: Control + C

Howto
-----

Basic workflow when using Dragonkeeper is as follows:

- Get a source distribution of Opera Dragonfly from http://bitbucket.org/scope/dragonfly-stp-1/

- In the terminal/shell, go to Dragonfly's directory and then run dragonkeeper. For e.g. if dragonkeeper is in the same parent directory as Dragonfly, then:
  python ../dragonkeeper/dragonkeeper/dragonkeeper.py
  
  should result in:
  
  server on: http://localhost:8002/
   
  
- Open that url in Opera. You will see a list of files.

- Open another instance of Opera from within your shell using

  /path/to/Opera.app/opera -pd /tmp
  
- In that browser's address bar, type opera:debug and then click 'Connect'.

- In the previous Opera instance with the list of files, navigate to src/client-en.xml 
  
- This will load Opera Dragonfly from the Dragonkeeper and connect to the new Opera instance.
  
Now, if you would like to debug Dragonfly, go to the browser which has Dragonfly Client open in the window, and start using the existing Dragonfly tools using Cmd + Alt + I


Advanced
--------

Settings:  an optional file CONFIG does overwrite the defaults.
The options file is a standard .ini file, with a single section called
"dragonkeeper":

[dragonkeeper]
host:
root: .
server_port: 8002
proxy_port: 7001
debug: False
format: False

Options:
  -h, --help            show this help message and exit
  -c CONFIG_PATH, --config=CONFIG_PATH
                        Path to config file
  -d, --debug           print message flow
  -f, --format          pretty print message flow
  -j, --format-payload  pretty print the message payload. can be very
                        expensive
  -r ROOT, --root=ROOT  the root directory of the server; default .
  -p PROXY_PORT, --proxy-port=PROXY_PORT
                        proxy port; default 7001
  -s SERVER_PORT, --server-port=SERVER_PORT
                        server port; default 8002
  --host=HOST           host; default localhost
  -i, --make-ini        Print a default dragonkeeper.ini and exit
  --force-stp-0         force stp 0 protocol
  --print-command-map   print the command map
  --message-filter=MESSAGE_FILTER
                        Filter the printing of the messages. The argument is
                        the filter or a path to a file with the filter. If the
                        filter is set, only messages which are listed in the
                        filter will be printed. The filter uses JSON notation
                        like: {"<service name>": {"<message type>":
                        [<message>*]}}", with message type one of "command",
                        "response", "event."  '*' placeholder are accepted in
                        <message>, e.g. a filter to log all threads may look
                        like:  "{'ecmascript-debugger': {'event':
                        ['OnThread*']}}".
  -v, --verbose         print verbose debug info
  --cgi                 enable cgi support


More comments in the source files.


Changelog
---------

See the CHANGELOG file

Contact
-------

Dragonkeeper is maintained by the Opera Dragonfly team. The authors are

- Christian Krebs <chrisk@opera.com>
- Rune Halvorsen <runeh@opera.com>
- Jan Borsodi <jborsodi@opera.com>

The Opera Dragonfly web site is at http://dragonfly.opera.com


License
-------

See the ``LICENSE`` file in the top distribution directory.